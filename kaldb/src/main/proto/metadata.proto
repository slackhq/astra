syntax = "proto3";

package slack.proto.kaldb;

option java_package = "com.slack.kaldb.proto.metadata";

message CacheSlotMetadata {
  enum CacheSlotState {
    FREE = 0;
    ASSIGNED = 1;
    LOADING = 2;
    LIVE = 3;
    EVICT = 4;
    EVICTING = 5;
  };

  // Name of the cache slot
  string name = 1;

  // Unique ID of the replica
  string replicaId = 2;

  // State of the cache slot
  CacheSlotState cacheSlotState = 3;

  // Last updated timestamp
  int64 updatedTimeUtc = 4;
}

message ReplicaMetadata {
  // Name of the replica
  string name = 1;

  // Unique ID for the snapshot blob
  string snapshotId = 2;

  // Last updated timestamp
  int64 createdTimeUtc = 4;

  // Timestamp after which this replica can be deleted
  int64 expireAfterUtc = 5;
}

message SnapshotMetadata {
  // Name of the snapshot
  string name = 1;
  // Permanent id for a blob. This id is used to uniquely identify the blob incase it get's copied around.
  // If not, should be same as name
  string snapshotId = 2;

  // Path of the file stored in blobstore.
  string snapshotPath = 3;
  // earliest timestamp of the event in the snapshot file.
  int64 startTimeUtc = 4;
  // End or latest timestamp of the event in the snapshot file.
  int64 endTimeUtc = 5;

  // Kafka partitionId.
  string partitionId = 7;
  // Kafka offset when this snapshot was taken for that partition.
  int64 maxOffset = 6;
}

message SearchMetadata {
  // Name of search metadata
  string name = 1;

  // snapshot name
  string snapshotName = 2;

  // url
  string url = 3;
}

message RecoveryNodeMetadata {
  enum RecoveryNodeState {
    FREE = 0;
    ASSIGNED = 1;
    RECOVERING = 2;
  }

  // Name of recovery node
  string name = 1;

  // Name of the recovery task
  string recoveryTaskName = 2;

  // State of the recovery node
  RecoveryNodeState recoveryNodeState = 3;

  // Last updated timestamp
  int64 updatedTimeUtc = 4;
}

message RecoveryTaskMetadata {
  // Name of recovery node
  string name = 1;

  // Kafka partitionId.
  string partitionId = 2;

  // Kafka offset (inclusive) to start at
  int64 startOffset = 3;

  // Kafka offset (inclusive) to end at
  int64 endOffset = 4;

  // Created timestamp
  int64 createdTimeUtc = 5;
}
